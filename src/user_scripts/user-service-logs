#!/bin/bash
# Просмотр логов сервисов пользователя

USERNAME=$(whoami)
SERVICE="code-server.service"

# Функция вывода помощи
show_help() {
    echo "Usage: $0 [lines]"
    echo ""
    echo "Examples:"
    echo "  $0                    # Show all logs (50 lines)"
    echo "  $0 100                # Show code-server logs (100 lines)"
    echo ""
}

# Основная логика
main() {
    local lines=$1

    case $lines in
        help|--help|-h)
            show_help
            return 0
            ;;
        *)
            if [ -z "$lines" ]; then
                lines=50
            fi

            if ! [[ "$lines" =~ ^[0-9]+$ ]]; then
                echo "Error: Invalid number of lines: $lines"
                return 1
            fi

            echo "=== Code Server logs (last $lines lines) ==="
            journalctl --user --lines="$lines" --no-pager \
                -u "$SERVICE"
            ;;
    esac
}

# Проверяем что не запущено от root
if [ "$EUID" -eq 0 ]; then
    echo "Error: This script should not be run as root"
    echo "Run as your regular user account"
    return 1
fi

# Проверяем доступность systemd --user
if ! systemctl --user daemon-reload 2>/dev/null; then
    echo "Error: User systemd is not available"
    echo "You may need to log in again or have linger enabled"
    return 1
fi

main "$@"
