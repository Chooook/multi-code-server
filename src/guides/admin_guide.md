
# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —Å–∏—Å—Ç–µ–º—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

## üìã –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [–û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã](#–æ–±–∑–æ—Ä-—Å–∏—Å—Ç–µ–º—ã)
2. [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](#–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç)
3. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
4. [–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞](#—É—Å—Ç–∞–Ω–æ–≤–∫–∞-–∏-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞)
5. [–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏](#—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏)
6. [–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏](#–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥-–∏-–ª–æ–≥–∏)
7. [–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫](#—É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ-–Ω–µ–ø–æ–ª–∞–¥–æ–∫)
8. [–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å](#–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)
9. [–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞](#—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞)
10. [FAQ](#faq)

## üéØ –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã

–°–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∫–∞–∂–¥–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é:
- **Code Server** (–≤–µ–±-–≤–µ—Ä—Å–∏—è VS Code) —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –∑–∞–ø—É—Å–∫–æ–º/–æ—Å—Ç–∞–Ω–æ–≤–∫–æ–π
- **Nginx –ø—Ä–æ–∫—Å–∏** –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ —á–µ—Ä–µ–∑ –≤—ã–¥–µ–ª–µ–Ω–Ω—ã–π –ø–æ—Ä—Ç
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ** —á–µ—Ä–µ–∑ systemd user units
- **–ò–∑–æ–ª—è—Ü–∏—é** –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

```
/etc/user-services/           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã
‚îú‚îÄ‚îÄ config                   # –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥
‚îú‚îÄ‚îÄ ports.db                 # –ë–∞–∑–∞ –ø–æ—Ä—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îú‚îÄ‚îÄ templates/               # –®–∞–±–ª–æ–Ω—ã –∫–æ–Ω—Ñ–∏–≥–æ–≤
‚îî‚îÄ‚îÄ scripts/                 # –°–∫—Ä–∏–ø—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

/usr/local/bin/              # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —É—Ç–∏–ª–∏—Ç—ã
‚îú‚îÄ‚îÄ user-service-control     # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞–º–∏
‚îú‚îÄ‚îÄ user-service-logs        # –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
‚îî‚îÄ‚îÄ user-code-server-set-password # –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è

/etc/systemd/user/           # Systemd —é–Ω–∏—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
/etc/nginx/user-services/    # –ö–æ–Ω—Ñ–∏–≥–∏ nginx
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞ 5 –º–∏–Ω—É—Ç:

```bash
# 1. –°–∫–∞—á–∞–π—Ç–µ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫
git clone <repository>
cd user-services-system
sudo ./setup.sh

# 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∫—É
sudo /etc/user-services/scripts/status-all.sh

# 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
sudo /etc/user-services/scripts/show-logs.sh <username>
```

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:

```bash
# –°—Ç–∞—Ç—É—Å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
sudo /etc/user-services/scripts/status-all.sh

# –û—á–∏—Å—Ç–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
sudo /etc/user-services/scripts/cleanup-user.sh <username>

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
sudo /etc/user-services/scripts/show-logs.sh <username> [service]

# –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
sudo /etc/user-services/scripts/create-user-services.sh
```

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ü–æ—Ç–æ–∫ —Ä–∞–±–æ—Ç—ã:

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí Nginx (–ø–æ—Ä—Ç 10000+) ‚Üí UNIX Socket ‚Üí Code Server
      ‚Üë                                          ‚Üë
      |                                          |
  systemd (–≥–ª–æ–±–∞–ª—å–Ω—ã–π)                   systemd (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π)
```

### –í—ã–¥–µ–ª–µ–Ω–∏–µ –ø–æ—Ä—Ç–æ–≤:

```bash
# –ê–ª–≥–æ—Ä–∏—Ç–º:
# 1. –ë–∞–∑–æ–≤—ã–π –ø–æ—Ä—Ç = BASE_PORT + (UID % 10000)
# 2. –ï—Å–ª–∏ –∑–∞–Ω—è—Ç ‚Üí –ø–æ—Ä—Ç + 1
# 3. –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ /etc/user-services/ports.db

# –ü—Ä–∏–º–µ—Ä:
UID 1001 ‚Üí nginx –ø–æ—Ä—Ç: 11001, codeserver –ø–æ—Ä—Ç: 21001
```

### Systemd —Å–µ—Ä–≤–∏—Å—ã:

- **code-server.socket** - –°–ª—É—à–∞–µ—Ç UNIX socket, –∑–∞–ø—É—Å–∫–∞–µ—Ç —Å–µ—Ä–≤–∏—Å –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏
- **code-server.service** - –°–∞–º code-server, –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ 1 —á–∞—Å –±–µ–∑ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- **nginx-proxy.service** - –õ–æ–∫–∞–ª—å–Ω—ã–π nginx –¥–ª—è –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è

## üîß –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:

- Linux —Å systemd
- Nginx
- Code-server (—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–ª–∏ –≤—Ä—É—á–Ω—É—é)
- Bash 4.0+

### –ü–æ–ª–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞:

```bash
# 1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone <repository-url>
cd user-services-system

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫
chmod +x setup.sh
sudo ./setup.sh

# 3. –ò–ª–∏ –¥–ª—è –±—ã—Å—Ç—Ä–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –±–µ–∑ code-server
sudo ./setup.sh --quick
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏:

```bash
# –¢–µ—Å—Ç –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
sudo ./setup.sh --test

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
sudo /etc/user-services/scripts/status-all.sh

# –ü—Ä–æ–≤–µ—Ä–∫–∞ nginx
curl http://localhost:9999  # —Ç–µ—Å—Ç–æ–≤—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:

–û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥: `/etc/user-services/config`

```ini
# –î–∏–∞–ø–∞–∑–æ–Ω—ã –ø–æ—Ä—Ç–æ–≤
NGINX_PROXY_PORT_MIN=10000
NGINX_PROXY_PORT_MAX=19999
NGINX_BASE_PORT=10000
CODESERVER_BASE_PORT=20000

# –¢–∞–π–º–∞—É—Ç –±–µ–∑–¥–µ–π—Å—Ç–≤–∏—è (—Å–µ–∫—É–Ω–¥—ã)
CODESERVER_IDLE_TIMEOUT=3600

# –î–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
SYSTEMD_USER_DIR=/etc/systemd/user
NGINX_CONF_DIR=/etc/nginx/user-services
```

## üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞:

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç —Å–µ—Ä–≤–∏—Å—ã –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å:
- UID ‚â• 1000
- –î–æ–º–∞—à–Ω–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–µ–π
- –†–∞–±–æ—á–µ–π –æ–±–æ–ª–æ—á–∫–æ–π (–Ω–µ /bin/false, /usr/sbin/nologin)

–ß–∞—Å—Ç–æ—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏: **–∫–∞–∂–¥—ã–µ 12 —á–∞—Å–æ–≤**

### –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:

```bash
# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
sudo /etc/user-services/scripts/create-user-services.sh

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
sudo /etc/user-services/scripts/create-user-services.sh --user <username>

# –û—á–∏—Å—Ç–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
sudo /etc/user-services/scripts/cleanup-user.sh <username>
sudo /etc/user-services/scripts/cleanup-user.sh 1001  # –ø–æ UID

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–æ–≤
cat /etc/user-services/ports.db
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

```bash
# 1. –°–æ–∑–¥–∞–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
adduser newuser

# 2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (—á–µ—Ä–µ–∑ 12 —á–∞—Å–æ–≤ –º–∞–∫—Å–∏–º—É–º)
# –ò–ª–∏ –≤—Ä—É—á–Ω—É—é:
sudo /etc/user-services/scripts/create-user-services.sh --user newuser

# 3. –î–∞–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –Ω–∞—á–∞–ª—å–Ω—ã–π –ø–∞—Ä–æ–ª—å
sudo cat /home/newuser/.code-server-initial-password.txt
```

### –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

```bash
# 1. –û—á–∏—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å—ã
sudo /etc/user-services/scripts/cleanup-user.sh <username>

# 2. –£–¥–∞–ª–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
deluser --remove-home <username>
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏

### –û–±—â–∏–π —Å—Ç–∞—Ç—É—Å:

```bash
# –ü–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç
sudo /etc/user-services/scripts/status-all.sh

# –¢–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
sudo /etc/user-services/scripts/status-all.sh | grep -E "(‚úì|ACTIVE)"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–æ–≤
ss -tuln | grep -E ":(1[0-9]{4}|2[0-9]{4})"
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤:

```bash
# –í—Å–µ –ª–æ–≥–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
sudo /etc/user-services/scripts/show-logs.sh <username>

# –õ–æ–≥–∏ code-server
sudo /etc/user-services/scripts/show-logs.sh <username> code-server

# –õ–æ–≥–∏ nginx
sudo /etc/user-services/scripts/show-logs.sh <username> nginx

# –ü–æ–∏—Å–∫ –æ—à–∏–±–æ–∫
sudo /etc/user-services/scripts/show-logs.sh <username> search "error"
```

### Systemd –ª–æ–≥–∏:

```bash
# –õ–æ–≥–∏ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ systemd
journalctl -u user-services-setup.service
journalctl -u user-services-setup.timer

# –õ–æ–≥–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
sudo -u <username> journalctl --user -u code-server.service
```

### Nginx –ª–æ–≥–∏:

```bash
# –î–æ—Å—Ç—É–ø –∫ –ª–æ–≥–∞–º
tail -f /var/log/nginx/user-<username>-access.log
tail -f /var/log/nginx/user-<username>-error.log

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
tail -f /var/log/nginx/access.log | grep :<–ø–æ—Ä—Ç>
```

## üîç –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –û–±—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:

#### 1. Code-server –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≤—Ä—É—á–Ω—É—é
curl -fsSL https://code-server.dev/install.sh | sh
# –∏–ª–∏
sudo snap install code-server --classic
```

#### 2. Nginx –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
nginx -t

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∫–ª—é—á–µ–Ω–∏–µ user-services
grep "include.*user-services" /etc/nginx/nginx.conf

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ
systemctl restart nginx
```

#### 3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å–µ—Ä–≤–∏—Å—ã –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ linger
loginctl show-user <username> | grep Linger

# –í–∫–ª—é—á–∏—Ç–µ linger
loginctl enable-linger <username>

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ user systemd
sudo -u <username> systemctl --user daemon-reload
```

#### 4. –ü–æ—Ä—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–Ω—è—Ç–æ—Å—Ç—å –ø–æ—Ä—Ç–∞
ss -tuln | grep :<–ø–æ—Ä—Ç>

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ firewall
iptables -L -n | grep <–ø–æ—Ä—Ç>
ufw status | grep <–ø–æ—Ä—Ç>

# –ü–µ—Ä–µ–≤—ã–¥–µ–ª–∏—Ç–µ –ø–æ—Ä—Ç—ã
rm /etc/user-services/ports.db
sudo /etc/user-services/scripts/create-user-services.sh
```

### –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:

```bash
# –ü–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
sudo /etc/user-services/scripts/status-all.sh | grep <username>
sudo /etc/user-services/scripts/show-logs.sh <username> all
sudo -u <username> systemctl --user status

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∫–µ—Ç–æ–≤
sudo -u <username> ss -xp | grep code-server

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
ps aux | grep <username> | grep -E "(code-server|nginx)"
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

1. **–û–±–Ω–æ–≤–ª—è–π—Ç–µ —Ä–µ–≥—É–ª—è—Ä–Ω–æ:**
   ```bash
   # Code-server
   sudo snap refresh code-server
   # –∏–ª–∏
   sudo /usr/local/bin/code-server --update
   
   # Nginx
   sudo apt update && sudo apt upgrade nginx
   ```

2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ firewall:**
   ```bash
   # –†–∞–∑—Ä–µ—à–∏—Ç–µ —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ—Ä—Ç—ã
   sudo ufw allow 22/tcp
   sudo ufw allow from <trusted_network> to any port 10000:19999
   sudo ufw enable
   ```

3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏:**
   ```bash
   # –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
   grep -E "(failed|error|attack)" /var/log/nginx/*.log
   
   # –ú–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –æ–¥–Ω–æ–≥–æ IP
   awk '{print $1}' /var/log/nginx/access.log | sort | uniq -c | sort -nr
   ```

4. **–†–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤:**
   ```bash
   # –î–æ–±–∞–≤—å—Ç–µ –≤ /etc/logrotate.d/nginx-user-services
   /var/log/nginx/user-*.log {
       daily
       missingok
       rotate 14
       compress
       delaycompress
       notifempty
       create 0640 www-data adm
       sharedscripts
       postrotate
           systemctl reload nginx
       endscript
   }
   ```

### –ò–∑–æ–ª—è—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:

- –ö–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–º–µ–µ—Ç —Å–≤–æ–∏ systemd —é–Ω–∏—Ç—ã
- –°–µ—Ä–≤–∏—Å—ã –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –æ—Ç –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- UNIX —Å–æ–∫–µ—Ç—ã —Å –ø—Ä–∞–≤–∞–º–∏ 0660

## ‚öô –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤ –ø–æ—Ä—Ç–æ–≤:

```bash
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥
sudo nano /etc/user-services/config

# –ò–∑–º–µ–Ω–∏—Ç–µ:
NGINX_PROXY_PORT_MIN=15000
NGINX_PROXY_PORT_MAX=15999

# –ü–µ—Ä–µ—Å–æ–∑–¥–∞–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥–∏
rm /etc/user-services/ports.db
sudo /etc/user-services/scripts/create-user-services.sh
```

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–∞–π–º–∞—É—Ç–∞ –±–µ–∑–¥–µ–π—Å—Ç–≤–∏—è:

```bash
# –í –∫–æ–Ω—Ñ–∏–≥–µ
CODESERVER_IDLE_TIMEOUT=1800  # 30 –º–∏–Ω—É—Ç

# –í —à–∞–±–ª–æ–Ω–µ templates/code-server.socket.tpl
IdleTimeoutSec=1800

# –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
sudo /etc/user-services/scripts/create-user-services.sh
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤:

1. –°–æ–∑–¥–∞–π—Ç–µ —à–∞–±–ª–æ–Ω—ã –≤ `/etc/user-services/templates/`
2. –î–æ–±–∞–≤—å—Ç–µ –ª–æ–≥–∏–∫—É –≤ `create-user-services.sh`
3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –Ω–∞ –æ–¥–Ω–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ

### –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ:

```bash
# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã
sudo tar -czf user-services-backup-$(date +%Y%m%d).tar.gz \
  /etc/user-services \
  /etc/nginx/user-services \
  /etc/systemd/user/*.service \
  /etc/systemd/user/*.socket

# –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
for user in /home/*; do
    if [ -d "$user/.config/code-server" ]; then
        sudo tar -czf "$user-code-server-$(date +%Y%m%d).tar.gz" \
          "$user/.config/code-server" \
          "$user/.local/share/code-server"
    fi
done
```

## ‚ùì FAQ

### Q: –ö–∞–∫ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é?
A: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —Å–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å —Å–∞–º: `user-code-server-set-password`
   –ò–ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç —Å–±—Ä–æ—Å–∏—Ç—å:
   ```bash
   sudo rm /home/<user>/.config/code-server/config.yaml
   sudo /etc/user-services/scripts/create-user-services.sh --user <user>
   ```

### Q: –ö–∞–∫ —É–≤–µ–ª–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π?
A: –ò–∑–º–µ–Ω–∏—Ç–µ –¥–∏–∞–ø–∞–∑–æ–Ω—ã –ø–æ—Ä—Ç–æ–≤ –≤ –∫–æ–Ω—Ñ–∏–≥–µ. –ú–∞–∫—Å–∏–º—É–º 10–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ –¥–∏–∞–ø–∞–∑–æ–Ω.

### Q: –°–µ—Ä–≤–∏—Å –Ω–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ —á–∞—Å
A: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
   ```bash
   # –ê–∫—Ç–∏–≤–Ω—ã –ª–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
   sudo -u <user> ss -xp | grep code-server
   
   # –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ–∫–µ—Ç–∞
   sudo -u <user> systemctl --user show code-server.socket | grep IdleTimeout
   ```

### Q: –ö–∞–∫ –æ—Ç–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É?
A: 
   ```bash
   systemctl disable --now user-services-setup.timer
   ```

### Q: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∂–∞–ª—É–µ—Ç—Å—è –Ω–∞ "Connection refused"
A: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ü–µ–ø–æ—á–∫—É:
   1. `sudo /etc/user-services/scripts/status-all.sh | grep <user>`
   2. `curl -I http://localhost:<–ø–æ—Ä—Ç>`
   3. `sudo /etc/user-services/scripts/show-logs.sh <user> nginx`

### Q: –ö–∞–∫ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –¥—Ä—É–≥–æ–π —Å–µ—Ä–≤–µ—Ä?
A:
   1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ `/etc/user-services/`
   2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ `/etc/nginx/user-services/`
   3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ `/etc/systemd/user/*.service`
   4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ `create-user-services.sh`

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

### –õ–æ–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏:

–ü—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∑–∞ –ø–æ–º–æ—â—å—é –ø—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ:
```bash
# –°–∏—Å—Ç–µ–º–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
sudo /etc/user-services/scripts/status-all.sh

# –õ–æ–≥–∏ –ø—Ä–æ–±–ª–µ–º–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
sudo /etc/user-services/scripts/show-logs.sh <username> all 100

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
grep -v "^#" /etc/user-services/config
```

### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:

```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã
sudo systemctl restart nginx
sudo /etc/user-services/scripts/create-user-services.sh

# –°–±—Ä–æ—Å –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
sudo /etc/user-services/scripts/cleanup-user.sh <username>
sudo /etc/user-services/scripts/create-user-services.sh --user <username>
```

---
*–í–µ—Ä—Å–∏—è —Å–∏—Å—Ç–µ–º—ã: 0.1.0*
*–û–±–Ω–æ–≤–ª–µ–Ω–æ: $(date +%Y-%m-%d)*
*–î–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –ø—Ä–æ–µ–∫—Ç–∞*
